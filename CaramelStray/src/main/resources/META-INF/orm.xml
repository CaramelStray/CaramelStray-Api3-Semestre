<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings xmlns="https://jakarta.ee/xml/ns/persistence/orm"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="https://jakarta.ee/xml/ns/persistence/orm https://jakarta.ee/xml/ns/persistence/orm/orm_3_0.xsd"
                 version="3.0">

    <sql-result-set-mapping name="EvolucaoMensalMapping">
        <constructor-result target-class="br.com.AllTallent.dto.MesQuantidadeDTO">
            <column name="mes" class="java.lang.String"/>
            <column name="quantidade" class="java.lang.Number"/>
        </constructor-result>
    </sql-result-set-mapping>

    <named-native-query name="FuncionarioRepository.findEvolucaoMensal" 
                          result-set-mapping="EvolucaoMensalMapping">
        <query>
            <![CDATA[
                SELECT 
                    TO_CHAR(DATE_TRUNC('month', data_admissao), 'YYYY-MM') AS mes,
                    COUNT(*) AS quantidade
                FROM 
                    tb_cad_funcionario
                WHERE 
                    data_admissao IS NOT NULL
                GROUP BY 
                    DATE_TRUNC('month', data_admissao)
                ORDER BY 
                    mes
            ]]>
        </query>
    </named-native-query>

    <named-native-query name="FuncionarioRepository.findEvolucaoMensalByArea" 
                          result-set-mapping="EvolucaoMensalMapping">
        <query>
            <![CDATA[
                SELECT 
                    TO_CHAR(DATE_TRUNC('month', data_admissao), 'YYYY-MM') AS mes,
                    COUNT(*) AS quantidade
                FROM 
                    tb_cad_funcionario
                WHERE 
                    data_admissao IS NOT NULL
                    AND codigo_area = :codigoArea
                GROUP BY 
                    DATE_TRUNC('month', data_admissao)
                ORDER BY 
                    mes
            ]]>
        </query>
    </named-native-query>

</entity-mappings>